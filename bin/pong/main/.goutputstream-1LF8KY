package pong.main;

import java.util.ArrayList;

import org.lwjgl.opengl.GL11;

public class WorldManager extends BaseGameObject {

	private static WorldManager $instance = null;

	private float x = 395;
	private float y = 0;
	private final float width = 10;
	private final float height = 58;

	private final int nO_Lines = 10;

	private ArrayList<BaseGameObject> wObjects = new ArrayList<BaseGameObject>();

	private KeyHandler keyHandler;

	private WorldManager(KeyHandler kHandler) {
		keyHandler = kHandler;
		hBox = new Rectangle(0, 0, 800, 600);
	}

	public static WorldManager getInstance(KeyHandler kHandler) {
		return ($instance == null ? $instance = new WorldManager(kHandler) : $instance);
	}

	@Override
	public void render() {
		for (int i = 0; i < nO_Lines; i++) {
			GL11.glBegin(GL11.GL_QUADS);
			{
				GL11.glColor3f(.5f, .5f, .5f);
				GL11.glVertex3f(x, y + (height * i + 20), 0);
				GL11.glVertex3f(x, y + (height * i + height), 0);
				GL11.glVertex3f(x + width, y + (height * i + height), 0);
				GL11.glVertex3f(x + width, y + (height * i + 20), 0);
			}
			GL11.glEnd();
		}
		for (BaseGameObject bgO : wObjects)
			bgO.render();
	}

	@Override
	public void update() {
		for (BaseGameObject bgO : wObjects) {
			if (bgO instanceof Player)
				((Player) bgO).input(keyHandler.getAllPressedKeys());
			bgO.update();
		}
	}

	/**
	 * Adds a new BaseGameObject to the world.<br>
	 * Only way to get it rendered.
	 * 
	 * @param obj
	 */
	public void addObject(BaseGameObject obj) {
		wObjects.add(obj);
	}

	public ArrayList<BaseGameObject> getWorldObjects(ArrayList<BaseGameObject> bgO) {
		return (bgO.containsAll(wObjects) ? bgO : wObjects);
	}

	// >> The data we receive is divided to two and two: the first couple is
	// object one and two. and the second couple is functions and variables.
	public void createCollision(BaseGameObject firstObj, BaseGameObject secObj,
			Couple<Couple<ArrayList<Object[]>>> data) {
		Collision firstCol = new Collision(firstObj, secObj);
		Collision secCol = new Collision(firstObj, secObj);
		Couple<ArrayList<Object[]>> firstColInstructSet = data.get(0);
		Couple<ArrayList<Object[]>> secColInstructSet = data.get(1);
		ArrayList<Object[]> firstCol_FUNC_InstructData = firstColInstructSet.get(0);
		ArrayList<Object[]> firstCol_VAR_InstructData = firstColInstructSet.get(1);
		ArrayList<Object[]> secCol_FUNC_InstructData = secColInstructSet.get(0);
		ArrayList<Object[]> secCol_VAR_InstructData = secColInstructSet.get(1);
		for (Object[] objArr : firstCol_FUNC_InstructData)
			firstCol.addInstruction((byte) 0, Collision.FUNCTION, objArr);
		for (Object[] objArr : firstCol_VAR_InstructData)
			firstCol.addInstruction((byte) 0, Collision.VARIABLE, objArr);
		for (Object[] objArr : secCol_FUNC_InstructData)
			secCol.addInstruction((byte) 1, Collision.FUNCTION, objArr);
		for (Object[] objArr : secCol_VAR_InstructData)
			secCol.addInstruction((byte) 1, Collision.VARIABLE, objArr);
		firstObj.collision(firstCol);
		secObj.collision(secCol);
	}

	public void setKeyHandler(KeyHandler newKHandler) {
		if (keyHandler == null)
			keyHandler = newKHandler;
	}

	public KeyHandler getKeyHandler() {
		return keyHandler;
	}

}
